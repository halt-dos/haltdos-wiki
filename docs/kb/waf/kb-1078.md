---
sidebar_position: 78
---

# KB: 1078

----

### **How to configure the Capture rule ?**

#### **Problem statement**

How can HTTPS traffic be selectively decrypted for analysis by securely logging SSL/TLS session keys based on configurable criteria using capture rule?

#### **Solution**

The WAF can log SSL/TLS session keys based on configurable criteria, enabling later decryption of HTTPS traffic.

**Steps to Solve**:-

1. Login into **Haltdos console**.

![kb-1078](/img/waf/v8/kb/kb_1063_overview.png)

2. Go to **Apps** > **WAF** > **Listener** > configure your listener

![kb-1078](/img/waf/v8/kb/kb_1078_listener.png)

3. Now go to **Rules** > **Capture Rule**.

![kb-1078](/img/waf/v8/kb/kb_1078_rules.png)

4. Now configure the **Capture Rule** based on the required specification.

![kb-1078](/img/waf/v8/kb/kb_1078_capturerule.png)

5. In the conditions section, users can select their required criteria, such as:
- **Find Location**: It includes various conditions such as client Browser, OS, Device, Source IP etc.   
- **Find Parameter**: Enter the parameter for the location. 
- **Match Condition**: It includes pattern exists, pattern don't exists, equals or not equals etc.
- **Match Value**: Enter the value for the match condition.

![kb-1078](/img/waf/v8/kb/kb_1078_conditions.png)

### With the capture rule in place, the next step is to decrypt the recorded SSL/TLS traffic using Wireshark.

**Requirements**

- Captured .pcap file from your network traffic.

- The SSL session key log file or server private key.

- Wireshark installed.

**If you have the Private Key (RSA only)**:

- Open Wireshark and load the .pcap file.

- Go to **Edit** > **Preferences** > **Protocols** > **TLS/SSL**.

**Under RSA Keys List, click Edit, then Add**:

- IP Address: 203.0.113.10 (Example server IP)

- Port: 443

- Protocol: http

- **Key File**: Browse and select the server’s .crt private key (e.g., private.crt)

- Click OK. Wireshark will now decrypt HTTPS packets using the private key.

**If you used Pre-Master Secrets from Capture Rule**:

- Get the key log file generated by Haltdos WAF from the capture rule.

- In Wireshark, go to **Edit** > **Preferences** > **Protocols** > **TLS**.

- Under (Pre)-Master-Secret log filename, enter the path to the key log file.

- Load your .pcap again — decrypted HTTPS data should now be visible.

:::note Note
    Refer to [KB-1069](./kb-1069.md) and [KB-1070](./kb-1070.md) for detailed guidance on **packet capture** and **SSL/TLS** decryption using **Wireshark**. 
:::