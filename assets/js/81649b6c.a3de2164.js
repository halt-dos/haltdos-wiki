/*! For license information please see 81649b6c.a3de2164.js.LICENSE.txt */
"use strict";(self.webpackChunkhaltdos_wiki=self.webpackChunkhaltdos_wiki||[]).push([[1244],{86694:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"kb/waf/kb-1077","title":"KB: 1077","description":"Introduction","source":"@site/docs/kb/waf/kb-1077.md","sourceDirName":"kb/waf","slug":"/kb/waf/kb-1077","permalink":"/kb/waf/kb-1077","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":77,"frontMatter":{"sidebar_position":77},"sidebar":"kb_sidebar","previous":{"title":"KB: 1076","permalink":"/kb/waf/kb-1076"},"next":{"title":"Application Delivery Controller","permalink":"/kb/adc/"}}');var t=i(74848),s=i(28453);const o={sidebar_position:77},c="KB: 1077",a={},l=[{value:"<strong>Introduction</strong>",id:"introduction",level:2},{value:"<strong>DECRYPTION METHODS</strong>",id:"decryption-methods",level:3},{value:"<strong>DECRYPTION USING SSL PRIVATE CERTIFICATE</strong>",id:"decryption-using-ssl-private-certificate",level:3},{value:"<strong>DECRYPTION USING SSLKEYLOGFILE</strong>",id:"decryption-using-sslkeylogfile",level:3},{value:"Diffie-Hellman (DH) key exchange",id:"diffie-hellman-dh-key-exchange",level:5},{value:"Forward Secrecy",id:"forward-secrecy",level:5},{value:"<strong>Why Diffie-Hellman Cannot Be Decrypted Using the Server\u2019s Private Key?</strong>",id:"why-diffie-hellman-cannot-be-decrypted-using-the-servers-private-key",level:3}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h5:"h5",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kb-1077",children:"KB: 1077"})}),"\n",(0,t.jsx)(n.h1,{id:"ssltls-decryption",children:(0,t.jsx)(n.strong,{children:"SSL/TLS DECRYPTION"})}),"\n",(0,t.jsx)(n.h2,{id:"introduction",children:(0,t.jsx)(n.strong,{children:"Introduction"})}),"\n",(0,t.jsx)(n.p,{children:"SSL/TLS is the secure mechanism that is used to perform communication between client and server. This technique share information using secure channel to transfer encrypted data between client and server such as personal or finanancial data."}),"\n",(0,t.jsx)(n.p,{children:"For troubleshooting, we will require to decrypt the traffic to determine and analyse the root cause. This document provides brief explaintaion to different technique to decrypt of SSL/TLS traffic."}),"\n",(0,t.jsx)(n.h3,{id:"decryption-methods",children:(0,t.jsx)(n.strong,{children:"DECRYPTION METHODS"})}),"\n",(0,t.jsx)(n.p,{children:"The below mentioned decryption techniques can be used to analyze SSL/TLS traffic."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Using ",(0,t.jsx)(n.a,{href:"/kb/waf/kb-1070",children:(0,t.jsx)(n.strong,{children:"SSL Private Certificate"})})]}),"\n",(0,t.jsxs)(n.li,{children:["Using ",(0,t.jsx)(n.a,{href:"/kb/waf/kb-1071",children:(0,t.jsx)(n.strong,{children:"SSLKEYLOGFILE"})})]}),"\n"]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["The recommended technique is ",(0,t.jsx)(n.strong,{children:"SSLKEYLOGFILE"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Note",type:"note",children:(0,t.jsx)(n.p,{children:"SSL private certificate is the sensitive information that is used to encrypt or decrypt application traffic. This SSL private certificate should not be shared with untrusted user and have limited access."})}),"\n",(0,t.jsx)(n.h3,{id:"decryption-using-ssl-private-certificate",children:(0,t.jsx)(n.strong,{children:"DECRYPTION USING SSL PRIVATE CERTIFICATE"})}),"\n",(0,t.jsx)(n.p,{children:"This technique is limited to specific SSL protocols i.e. TLS v1.2 or lower, and RSA based cipher suites."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"The traffic can be decrypted only with same private certificate that used in the encryption."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The RSA based key exchanges allow the server\u2019s private certificate to decrypt with the pre-master secret, that can be used to derive the session key. Further, the same SSL private certificate will have same session key for each communication between client and server. This allow RSA key exchanges to easily decrypt SSL traffic with the server's private certificate."}),"\n",(0,t.jsx)(n.admonition,{title:"Note",type:"warning",children:(0,t.jsx)(n.p,{children:"The RSA based SSL cipher suites can be decrypted by stolen private certificate. This stolen private certificate can also be used to decrypt past communication and should be avoided to use in the production environment."})}),"\n",(0,t.jsxs)(n.p,{children:["To decrypt SSL/TLS traffic using the server\u2019s private certificate, we have to enable ",(0,t.jsx)(n.strong,{children:"RSA based cipher suites"})," on the WAF or application server. The RSA based cipher suites will enforce in the communication and allow us to decrypt traffic."]}),"\n",(0,t.jsx)(n.p,{children:"Here are the general steps to enable weak ciphers for SSL/TLS decryption:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Application Server"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Access the application configuration"}),"\n",(0,t.jsx)(n.li,{children:"Enable Weak Ciphers"}),"\n",(0,t.jsx)(n.li,{children:"Save Changes"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Haltdos WAF"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Go to application SSL configuration"}),"\n",(0,t.jsx)(n.li,{children:"Change SSL Ciphers to CUSTOM."}),"\n",(0,t.jsx)(n.li,{children:"Select SSL protocol as TLSv1.2 or lower and RSA based ciphers"}),"\n",(0,t.jsx)(n.li,{children:"Save Changes"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"RSA based SSL setting\n\n    Protocol: TLSv1.2\n    Cipher: TLS_RSA_WITH_AES_256_CBC_SHA\n"})}),"\n",(0,t.jsx)(n.p,{children:"The below information required to decrypt SSL traffic"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Packet Capture between client and server using tcpdump"}),"\n",(0,t.jsx)(n.li,{children:"SSL private certificate"}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{title:"Note",type:"warning",children:(0,t.jsxs)(n.p,{children:["These changes should only be made in a ",(0,t.jsx)(n.strong,{children:"controlled environment"})," (e.g., for debugging or testing purposes), as weak ciphers introduce significant security risks."]})}),"\n",(0,t.jsx)(n.h3,{id:"decryption-using-sslkeylogfile",children:(0,t.jsx)(n.strong,{children:"DECRYPTION USING SSLKEYLOGFILE"})}),"\n",(0,t.jsxs)(n.p,{children:["For application with modern SSL protocols and cipher suites, this technique can be used for decryption. The modern protocol are using forward secracy to encrypt SSL information for each session. The technique support ",(0,t.jsx)(n.strong,{children:"Diffie-Hellman"})," key exchange."]}),"\n",(0,t.jsx)(n.h5,{id:"diffie-hellman-dh-key-exchange",children:"Diffie-Hellman (DH) key exchange"}),"\n",(0,t.jsxs)(n.p,{children:["Diffie-Hellman includes elliptic-curve variant (ECDHE), that is fundamentally different from other key exchange methods like RSA. The key reason is that DH does not rely on the server\u2019s private certificate to establish the shared session key. The below factors allow each session indepedent using same SSL private certificate. Diffie-Hellman key exchanges are often used in combination with ",(0,t.jsx)(n.strong,{children:"forward secrecy"}),"."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Ephemeral Keys"}),": Diffie-Hellman generates unique, temporary session keys for each session. These keys are not tied to the server's long-term private certificate."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Session Key Independence"}),": Even if the server\u2019s private certificate is compromised, the keys used in previous sessions remain secure."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"forward-secrecy",children:"Forward Secrecy"}),"\n",(0,t.jsxs)(n.p,{children:["Forward secrecy ensures that even if the server\u2019s private certificate is compromised, ",(0,t.jsx)(n.strong,{children:"previous sessions cannot be decrypted"}),". Forward secrecy is critical in environments where long-term security is a concern, ensuring that sensitive data remains protected even in the event of a key compromise."]}),"\n",(0,t.jsx)(n.p,{children:"The below information required to decrypt SSL traffic"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Packet Capture between client and server using tcpdump"}),"\n",(0,t.jsx)(n.li,{children:"SSLKEYLOG file"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"why-diffie-hellman-cannot-be-decrypted-using-the-servers-private-key",children:(0,t.jsx)(n.strong,{children:"Why Diffie-Hellman Cannot Be Decrypted Using the Server\u2019s Private Key?"})}),"\n",(0,t.jsx)(n.p,{children:"The Diffie-Hellman (DH) key exchange protocol is designed to allow two parties to securely share a secret key over a public channel, without actually transmitting the key itself. The protocol relies on the mathematical properties of modular exponentiation and the difficulty of the discrete logarithm problem to ensure security."}),"\n",(0,t.jsxs)(n.p,{children:["The limitations of ",(0,t.jsx)(n.strong,{children:"Diffie-Hellman"})," key exchanges and the concept of ",(0,t.jsx)(n.strong,{children:"Forward Secrecy"}),", which impacts the ability to decrypt past sessions."]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},21020:(e,n,i)=>{var r=i(96540),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,c=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(e,n,i){var r,s={},l=null,d=null;for(r in void 0!==i&&(l=""+i),void 0!==n.key&&(l=""+n.key),void 0!==n.ref&&(d=n.ref),n)o.call(n,r)&&!a.hasOwnProperty(r)&&(s[r]=n[r]);if(e&&e.defaultProps)for(r in n=e.defaultProps)void 0===s[r]&&(s[r]=n[r]);return{$$typeof:t,type:e,key:l,ref:d,props:s,_owner:c.current}}n.Fragment=s,n.jsx=l,n.jsxs=l},74848:(e,n,i)=>{e.exports=i(21020)},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var r=i(96540);const t={},s=r.createContext(t);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);